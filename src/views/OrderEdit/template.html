<div id="Order">
    <v-container v-if="order_data!=null">
        <CommentDialog v-on:load-data="GetOrders" ref="CommentDialog" />
        <PrintOrder :order_data="order_data" ref="PrintOrder" />
        <v-row>
            <Breadcrumb :link_array="breadcrumb_data" />
            <v-col cols="12" md="12" lg="12" class="mx-auto py-0">
                <div class="header d-flex justify-space-between align-center">
                    <h3 class="my-0 text-h5 font-weight-black">#{{order_data.order_id}}
                        <span
                            class="text-body-2 grey--text text--darken-1 font-weight-regular ml-2">{{order_data.create_time}}</span>
                        <v-chip :class="status_array[order_data.status].color"
                            :text-color="status_array[order_data.status]['text-color']" class="ma-2 caption" small>
                            {{status_array[order_data.status].label}}
                        </v-chip>
                    </h3>
                </div>
            </v-col>
            <v-col cols="12" md="12" lg="12" class="mx-auto py-0">
                <v-menu offset-y>
                    <template v-slot:activator="{ on, attrs }">
                        <v-btn class="px-0 mr-4" color="green" small text v-bind="attrs" v-on="on">
                            <v-icon small class="mr-1">mdi-list-status</v-icon>變更訂單狀態
                        </v-btn>
                    </template>
                    <v-list>
                        <v-list-item v-for="(item, index) in status_array" :key="`status_${index}`">
                            <v-list-item-title>
                                <v-btn text :color="GetStatusActive(item.label)" @click="UpdateStatus(index)">
                                    {{ item.label }}
                                </v-btn>
                            </v-list-item-title>
                        </v-list-item>
                    </v-list>
                </v-menu>
                <v-btn class="px-0 mr-4" color="primary" small text @click="Print">
                    <v-icon small class="mr-1">mdi-printer</v-icon>出貨單
                </v-btn>
                <v-btn v-if="order_data.payment == 'zero_card'" class="px-0" color="error" small text @click="Refund">
                    <v-icon small class="mr-1">mdi-printer</v-icon>退款
                </v-btn>
            </v-col>
        </v-row>
        <v-row>
            <v-col cols="12" md="8">
                <v-card elevation="2" class="pa-8 mb-5 rounded-lg">
                    <v-row>
                        <v-col cols="12" md="6">
                            <p class="mb-0">訂單總金額</p>
                            <h3 class="text-h4 font-weight-bold">{{order_data.total_price | money_format}} TWD</h3>
                            <p class="caption" v-if="order_data.status!='P'">尚未付款
                            </p>
                            <p class="caption" v-if="order_data.status=='P' || order_data.status=='S'">
                                已完成付款
                            </p>
                        </v-col>
                        <v-col cols="12" md="6">
                            <p class="mb-0">商品總數</p>
                            <h3 class="text-h4 font-weight-bold">{{order_data.products.length}}</h3>
                            <p class="caption" v-if="order_data.status =='S'">已出貨</p>
                            <p class="subtitle-2 caption" v-else>尚未出貨</p>
                            <v-btn @click="Print" class="elevation-0 " color="grey lighten-3">出貨單</v-btn>
                        </v-col>
                        <v-col cols="12">
                            <v-divider class="my-5"></v-divider>
                            <v-row v-for="(item,item_index) in order_data.products" :key="`product_${item_index}`">
                                <v-col cols="6" md="4" class="pa-2">
                                    <p class="my-0 blue--text"> {{item.name}}</p>
                                    <span class="caption"> {{item.options}}</span>
                                </v-col>
                                <v-col cols="6" md="4" class="pa-2 d-flex align-center justify-end">
                                    <p class="my-0 "> {{item.price | money_format}} TWD x {{item.amount}}</p>
                                </v-col>
                                <v-col cols="6" md="4" class="pa-2 d-flex align-center justify-end">
                                    <p class="my-0"> {{(item.price*item.amount) | money_format}} TWD</p>
                                </v-col>
                            </v-row>
                            <v-row>
                                <v-col cols="6" md="4" class="pa-2">
                                    <p class="my-0 blue--text">運費</p>
                                </v-col>
                                <v-col cols="6" md="4" class="pa-2 d-flex align-center justify-end">
                                    <p class="my-0 "></p>
                                </v-col>
                                <v-col cols="6" md="4" class="pa-2 d-flex align-center justify-end">
                                    <p class="my-0"> {{(order_data.shipping_fee) | money_format}} TWD</p>
                                </v-col>
                            </v-row>

                            <v-divider class="mt-5 "></v-divider>
                        </v-col>
                        <v-col cols="12">
                            <v-row v-if="order_data.payment!='zero_card'">
                                <v-col cols="6">
                                    <p class="mb-1 font-weight-bold">綠界編號</p>
                                    <p class="mb-0 body-2 grey--text text--darken-1">{{order_data.ec_pay.trade_no}}</p>
                                </v-col>
                                <v-col cols="6">
                                    <p class="mb-1 font-weight-bold">綠界狀態</p>
                                    <p class="mb-0 body-2 grey--text text--darken-1">{{order_data.ec_pay.return_msg}}
                                    </p>
                                </v-col>
                                <v-col cols="12">
                                    <p class="mb-1 font-weight-bold">客戶備註</p>
                                    <p class="mb-0 body-2 grey--text text--darken-1">{{order_data.comment}}
                                    </p>
                                </v-col>
                            </v-row>
                            <v-row v-if="order_data.payment=='zero_card'">
                                <v-col cols="6">
                                    <p class="mb-1 font-weight-bold">零卡分期APP編號</p>
                                    <p class="mb-0 body-2 grey--text text--darken-1">{{order_data.zc_pay.spanapp_id}}
                                    </p>
                                </v-col>
                                <v-col cols="6">
                                    <p class="mb-1 font-weight-bold">交易狀態</p>
                                    <p class="mb-0 body-2 grey--text text--darken-1">
                                        {{order_data.zc_pay.transaction_state}}
                                    </p>
                                </v-col>
                                <v-col cols="6">
                                    <p class="mb-1 font-weight-bold">核准授權日</p>
                                    <p class="mb-0 body-2 grey--text text--darken-1">
                                        {{order_data.zc_pay.auth_day}}
                                    </p>
                                </v-col>
                                <v-col cols="6">
                                    <p class="mb-1 font-weight-bold">分期期數</p>
                                    <p class="mb-0 body-2 grey--text text--darken-1">
                                        {{order_data.zc_pay.installment}}
                                    </p>
                                </v-col>
                                <v-col cols="6">
                                    <p class="mb-1 font-weight-bold">第一期金額</p>
                                    <p class="mb-0 body-2 grey--text text--darken-1">
                                        {{order_data.zc_pay.first_payment | money_format}} TWD
                                    </p>
                                </v-col>
                                <v-col cols="6">
                                    <p class="mb-1 font-weight-bold">每期金額</p>
                                    <p class="mb-0 body-2 grey--text text--darken-1">
                                        {{order_data.zc_pay.each_payment | money_format}} TWD
                                    </p>
                                </v-col>
                                <v-col cols="12">
                                    <p class="mb-1 font-weight-bold">客戶備註</p>
                                    <p class="mb-0 body-2 grey--text text--darken-1">{{order_data.comment}}
                                    </p>
                                </v-col>
                            </v-row>
                        </v-col>
                    </v-row>
                </v-card>
            </v-col>
            <v-col cols="4">
                <v-card elevation="2" class="pa-8 mb-5 rounded-lg">
                    <h3 class="d-flex align-center mb-4">
                        <v-icon class="mr-2">mdi-account</v-icon>客戶資訊
                    </h3>
                    <p class="mb-0 font-weight-black">{{order_data.name}}</p>
                    <p class="mb-2 grey--text text--darken-2 body-2">{{order_data.address}}</p>
                    <p class="mb-0 grey--text text--darken-2 body-2">{{order_data.phone}}</p>
                    <p class="mb-0 grey--text text--darken-2 body-2">{{order_data.email}}</p>
                </v-card>
                <v-card elevation="2" class="pa-8 mb-5 rounded-lg">
                    <h3 class="d-flex align-center mb-4">
                        <v-icon class="mr-2">mdi-store</v-icon>商家備註欄
                    </h3>
                    <p v-if="order_data.order_comment!=''" class="mb-0 font-weight-black">{{order_data.order_comment}}
                    </p>
                    <p v-else class="mb-0 body-2">留下備註...</p>
                    <v-row>
                        <v-col class="d-flex justify-end mt-4">
                            <v-btn @click="OpenCommentDialog" class="elevation-0 " color="grey lighten-3">編輯</v-btn>
                        </v-col>
                    </v-row>
                </v-card>
            </v-col>
        </v-row>
    </v-container>
</div>